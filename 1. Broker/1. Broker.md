# 1 Broker

## 1.0 Pendahuluan
Broker merupakan penghubung lojik niaga dengan dunia luar. Mereka adalah pembalut bagi perpustakaan luaran, sumber-sumber, khidmat-khidmat, atau API-API yang memenuhi kehendak suatu '_interface_' lokal agar perniagaan boleh berinteraksi dengan mereka tanpa diikat ketat dengan mana-mana sumber atau pelaksanaan perpustakaan luaran tertentu.

Broker, secara amnya, ditakdir menjadi boleh dibuang dan boleh diganti; mereka dibina dengan pemahaman bahawa teknologi berkembang ubah setiap masa. Maka akan tiba waktunya apabila ia perlu diganti dengan teknologi baru yang lebih cekap menjalankan tugas.

Tetapi broker turut memastikan perniagaan anda boleh dipalam melalui pengabstrakan mana-mana kebergantungan sumber luaran daripada apa yang cuba dicapai oleh perisian anda.

Contohnya, katakan anda mempunyai sebuah API bagi memakai dan melayan data dari suatu server SQL. Suatu hari anda berputus bahawa adalah lebih jimat bagi API anda untuk menggunakan teknologi NoSql. Dengan adanya broker, kita dapat memutuskan kebergantungan terhadap SQL dan kemudiannya bersepadu dengan NoSql dengan jauh lebih senang dan mengguna pakai masa dan tenaga kerja yang sekurang mungkin.

## 1.1 Atas Peta
Dalam mana-mana aplikasi termasuklah aplikasi mudah alih, '_desktop_', sesawang, atau cuma API, broker biasanya duduk di bahagian "ekor" kerana mereka bertindak sebagai titik pertemuan terakhir antara kod tersuai dan dunia luar.

Sama ada dunia luar itu cumalah storan lokal dalam memori atau sebuah sistem bebas yang berdiam di belakang suatu API, mereka semuanya perlu berdiam di belakang Broker dalam mana-mana aplikasi.

Dalam contoh seni bina aras rendah sesebuah API berikut - Broker berdiam di antara lojik niaga dan sumber luaran:

<br />
    <p align=center>
        <img src="https://github.com/hassanhabib/The-Standard-Malaysian/blob/main/1.%20Broker/Sumber/Brokers.png" />
    </p>
<br />

## 1.2 Perwatakan
Terdapat beberapa hukum mudah yang mentadbir pelaksanaan sesuatu broker - hukum-hukumnya adalah seperti berikut:

### 1.2.0 Melaksanakan Interface Lokal
Broker-broker haruslah memenuhi syarat suatu kontrak. Mereka mesti melaksanakan suatu interface lokal bagi membolehkan penyahgandingan antara pelaksanaannya dan khidmat-khidmat yang memakainya.

Contohnya, katakan kita punyai suatu kontrak lokal `IBrokerStoran` yang memerlukan pelaksanaan bagi mana-mana operasi CBKP (Cipta, Baca, Kemaskini, Padam) - '_CRUD (Create, Read, Update, Delete)_' untuk suatu model lokal `Pelajar`; operasi kontrak tersebut adalah seperti berikut:

```csharp
    public partial interface IBrokerStoran
    {
        IQueryable<Pelajar> PilihSemuaPelajar();
    }
```

Pelaksanaan broker storan adalah seperti berikut:

```csharp
    public partial class BrokerStoran
    {
        public DbSet<Pelajar> ParaPelajar { get; set; }

        public IQueryable<Pelajar> PilihSemuaPelajar() =>
            PilihSemua<Pelajar>();
    }
```

Suatu pelaksanaan kontrak lokal boleh diganti bila-bila masa, melalui penggunaan Entity Framework seperti ditunjuk dalam contoh di atas agar boleh mengguna pakai sesuatu teknologi lain seperti Dapper atau sebuah infrastruktur yang langsung berlainan seperti pangkalan data Oracle atau PostgreSQL.

### 1.2.1 Tiada Kawalan Aliran
Broker tidak seharusnya mempunyai sebarang bentuk kawalan aliran seperti _if_, _while_, atau _switch_; ini kerana kod kawalan aliran dianggap sebagai kawalan niaga, dan lebih padan diguna di lapisan khidmat di mana lojik niaga patut diami, bukannya di broker.

Contohnya, suatu cara broker untuk mendapatkan semula senarai pelajar dari pangkalan data akan kelihatan seperti berikut:

```csharp
    public IQueryable<Pelajar> PilihSemuaPelajar() => PilihSemua<Pelajar>();
```

Satu fungsi mudah yang memanggil `DbSet<T>` EntityFramework asli dan memulangkan sebuah model lokal seperti `Pelajar`.

### 1.2.2 Tiada Pengendalian Pengecualian
Pengendalian pengecualian adalah satu bentuk kawalan aliran. Broker tidak seharusnya mengendali sebarang pengecualian dan seharusnya membiarkannya disebarkan kepada khidmat yang berjiran dengan broker, di mana ia dapat dipeta dan disetempat dengan betul.

### 1.2.3 Kendali Konfigurasi Sendiri
Broker perlu kendali konfigurasinya sendiri - mereka mungkin mempunyai suntikan kebergantungan daripada sesuatu objek konfigurasi untuk mendapatkan dan menyediakan konfigurasi bagi mana-mana sumber luaran yang disepadu.

Contohnya, rentetan sambungan - "_connection strings_" dalam komunikasi pangkalan data perlulah didapatkan dan dihantar kepada pelanggan pangkalan data bagi menubuhkan suatu sambungan yang berjaya, seperti berikut:

```csharp
    public partial class BrokerStoran : EFxceptionsContext, IBrokerStoran
    {
        private readonly IKonfigurasi konfigurasi;

        public BrokerStoran(IKonfigurasi konfigurasi)
        {
            this.konfigurasi = konfigurasi;
            this.Database.Migrate();
        }

        ...
        ...

        protected override void OnConfiguring(DbContextOptionsBuilder pembinaPilihan)
        {
            pembinaPilihan.UseQueryTrackingBehavior(QueryTrackingBehavior.NoTracking);
            string rentetanSambungan = this.konfigurasi.GetConnectionString("DefaultConnection");
            pembinaPilihan.UseSqlServer(rentetanSambungan);
        }
    }
```